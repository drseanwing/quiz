# Development override configuration
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  db:
    ports:
      - "9470:5432"  # PostgreSQL - mapped to 9470 (range: 9470-9490)

  backend:
    build:
      target: development
    container_name: redi-quiz-backend-dev
    environment:
      NODE_ENV: development
      LOG_LEVEL: debug
      ENABLE_DEBUG: "true"
      MOCK_EMAIL: "true"  # Mock email sending in development
    volumes:
      - ./backend:/app
      - /app/node_modules  # Anonymous volume to prevent overwriting node_modules
      - uploads:/app/uploads
      - logs:/app/logs
    command: npm run dev
    ports:
      - "9471:3000"  # Backend API - mapped to 9471
      - "9472:9229"  # Node.js debugger - mapped to 9472

  frontend:
    build:
      target: development
    container_name: redi-quiz-frontend-dev
    environment:
      NODE_ENV: development
      VITE_API_URL: ${VITE_API_URL:-http://localhost:9471/api}
    volumes:
      - ./frontend:/app
      - /app/node_modules
    command: npm run dev
    ports:
      - "9473:5173"  # Frontend Vite dev server - mapped to 9473

  nginx:
    volumes:
      - ./nginx/nginx.dev.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "9476:80"  # Nginx (optional in dev) - mapped to 9476

  # Prisma Studio for database management
  prisma-studio:
    image: node:20-alpine
    container_name: redi-quiz-prisma-studio
    working_dir: /app
    environment:
      DATABASE_URL: ${DATABASE_URL}
    volumes:
      - ./backend:/app
    command: sh -c "npm install && npx prisma studio"
    ports:
      - "9474:5555"  # Prisma Studio - mapped to 9474
    depends_on:
      - db
    networks:
      - redi-network
    profiles:
      - tools  # Only start with --profile tools

  # Adminer for database administration
  adminer:
    image: adminer:latest
    container_name: redi-quiz-adminer
    restart: unless-stopped
    ports:
      - "9475:8080"  # Adminer - mapped to 9475
    environment:
      ADMINER_DEFAULT_SERVER: db
      ADMINER_DESIGN: nette
    depends_on:
      - db
    networks:
      - redi-network
    profiles:
      - tools  # Only start with --profile tools
